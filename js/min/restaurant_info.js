let restaurant,map,newMap;window.initMap=(()=>{fetchRestaurantFromURL(e=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)})});const fetchRestaurantFromURL=()=>{if(self.restaurant)return Promise.resolve(self.restaurant);const e=parseInt(getParameterByName("id"));return e&&e!==isNaN?DBHelper.fetchRestaurantById(e).then(e=>(self.restaurant=e,e?(self.restaurant=e,fillRestaurantHTML(),e):Promise.reject("restaurant not found"))):Promise.reject("No Restaurant found")},fillRestaurantHTML=(e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=`images/${e.photograph}-thumbnail.webp`,t.setAttribute("alt",`${e.name}`),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviewsById(e.id).then(e=>{fillReviewsHTML(e)})},fillRestaurantHoursHTML=(e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const s=document.createElement("td");s.innerHTML=e[n],r.appendChild(s),t.appendChild(r)}},fillReviewsHTML=(e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-show"),n=document.createElement("h3");if(n.innerHTML="Stand on the shoulders of giants! Read the reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)},createReviewHTML=e=>{const t=document.createElement("li");if(!navigator.onLine){const e=document.createElement("p");e.setAttribute("class","offline_label"),e.innerHTML="Your currently offline we will update when you reconnect",t.setAttribute("class","offline"),t.appendChild(e)}t.setAttribute("class","review__results");const n=document.createElement("p");n.setAttribute("class","review__details"),n.innerHTML=`name: ${e.name}`,t.appendChild(n);const r=document.createElement("p");r.setAttribute("class","review__details"),r.innerHTML=`Date: ${new Date(e.createdAt).toLocaleString()}`,t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}/5`,a.setAttribute("class","review__details"),t.appendChild(a);const s=document.createElement("p");return s.setAttribute("class","comments__details"),s.setAttribute("class","review__details"),s.innerHTML=e.comments,t.appendChild(s),t},addReview=()=>{event.preventDefault();const e=getParameterByName("id"),t=document.querySelector("#name").value;let n;const r=document.querySelector("#comments").value,a=[t,n=document.querySelector("#rating option:checked").value,r,e],s={restaurantId:parseInt(a[3]),rating:parseInt(a[1]),name:a[0],comments:a[2],createdAt:new Date};DBHelper.addReview(s),addReviewHTML(s),document.querySelector(".reviews__post__container")},addReviewHTML=e=>{document.querySelector("#no-review")&&document.querySelector("#no-review").remove();const t=document.querySelector("#reviews-show"),n=document.querySelector("#reviews-list");n.insertBefore(createReviewHTML(e),n.firstChild),t.appendChild(n)},fillBreadcrumb=(e=self.restaurant)=>{document.getElementById("breadcrumb").innerHTML=`<a href="/" class="link__home" aria-label="home" aria-current="page"><i class="fas fa-home font__basic"></i><span class="link__home--text font__basic">Home/${e.name}</span></a>`},getParameterByName=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};