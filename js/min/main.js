let restaurants,neighborhoods,cuisines,map,markers=[];document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines(),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log(`Registration was a success with scope: ${e.scope}`)},function(e){console.log(`ServiceWorker registration failed: ${e}`)})})});const fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods().then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()})},fillNeighborhoodsHTML=(e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})},fetchCuisines=()=>{DBHelper.fetchCuisines().then(e=>{self.cuisines=e,fillCuisinesHTML()})},fillCuisinesHTML=(e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})};window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()});const updateRestaurants=()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,r=t.selectedIndex,n=e[s].value,a=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,a).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>console.error(e))},resetRestaurants=e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(e=>e.remove()),self.markers=[],self.restaurants=e},fillRestaurantsHTML=(e=self.restaurants)=>{const t=document.getElementById("restaurants-list");t.setAttribute("aria-label","restaurants name"),e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=e=>{const t=document.createElement("li");t.setAttribute("class","restaurant__result__list");const s=document.createElement("img");s.setAttribute("alt",`${e.name}`);new IntersectionObserver((t,s)=>{t.forEach(t=>{t.intersectionRatio>0&&(console.log(t.intersectionRatio),(t=>{t.setAttribute("class","restaurant-img"),t.src=`images/${e.photograph}-thumbnail.webp`})(t.target),s.unobserve(t.target))})},{root:null,rootMargin:"0px",threshold:.1}).observe(s),t.append(s);const r=document.createElement("h2");r.setAttribute("class","restaurants__name"),r.innerHTML=`<strong>${e.name}</strong>`,t.append(r);const n=document.createElement("button");n.innerHTML="❤",n.setAttribute("class","like__btn"),n.setAttribute("aria-label","click to make favourite"),n.onclick=(()=>{const t=!e.is_favorite;DBHelper.updateFavouriteRestaurant(e.id,t),e.is_favorite=!e.is_favorite,toggleFavourites(n,e.is_favorite)}),toggleFavourites(n,e.is_favorite),t.appendChild(n);const a=document.createElement("p");a.innerHTML=`<strong>${e.neighborhood}</strong>`,t.append(a);const o=document.createElement("p");o.innerHTML=`<strong>${e.address}</strong>`,t.append(o);const i=document.createElement("a");return i.innerHTML="<i> - View Details - </i> <br /> <br />",i.className="restaurant__link",i.href=DBHelper.urlForRestaurant(e),t.append(i),t},toggleFavourites=(e,t)=>{t?(e.classList.remove("not__liked"),e.setAttribute("class","liked"),e.setAttribute("aria-label","Remove as a favourite restaurant")):(e.classList.remove("liked"),e.setAttribute("class","not__liked"),e.setAttribute("aria-label","Click to mark as a favourite restaurant"))},addMarkersToMap=(e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);t.on("click",()=>{window.location.href=t.options.url}),self.markers.push(t)})};